let currentSelectedShape="";const metalColors={STEEL_GRAY:"#71797E",STAINLESS_STEEL:"#CFD4D9",ALUMINUM:"#D9DAD9",BRASS:"#C49E5B",BRONZE:"#CD7F32",COPPER:"#B87333",CAST_IRON:"#61666A",NICKEL_GRAY:"#727472",MAGNESIUM:"#c1c2c3",BERYLLIUM:"#c0c0c0",TITANIUM:"#7A7772",ZIRCONIUM:"#EDF0F1",ZINC:"#BAC4C8",MOLYBDENUM:"#96919c",SILVER_CHROME:"#C0C0C0",LEAD:"#212121",TANTALUM:"#A0A0AB",TUNGSTEN:"#b5ac9f",GOLD:"#FFD700",PLATINUM:"#E5E4E2",GUNMETAL:"#2C3539",POTASSIUM:"#E8E8E8"},contrastBackgrounds={LIGHT_GRAY:"#F0F0F0",DARK_BLUE:"#2C3E50",SLATE_BLUE:"#34495E",WHITE_SMOKE:"#F8F9FA"},materialsData={"Steel / MS":{density:7.85,color:metalColors.STEEL_GRAY,contrastBg:contrastBackgrounds.LIGHT_GRAY},"Stainless Steel":{density:8,color:metalColors.STAINLESS_STEEL,contrastBg:contrastBackgrounds.DARK_BLUE},Aluminum:{density:2.7,color:metalColors.ALUMINUM,contrastBg:contrastBackgrounds.SLATE_BLUE},Brass:{density:8.5,color:metalColors.BRASS,contrastBg:contrastBackgrounds.DARK_BLUE},Bronze:{density:8.78,color:metalColors.BRONZE,contrastBg:contrastBackgrounds.DARK_BLUE},Copper:{density:8.96,color:metalColors.COPPER,contrastBg:contrastBackgrounds.DARK_BLUE},"Cast Iron":{density:7.2,color:metalColors.CAST_IRON,contrastBg:contrastBackgrounds.LIGHT_GRAY},Nickel:{density:8.9,color:metalColors.NICKEL_GRAY,contrastBg:contrastBackgrounds.LIGHT_GRAY},Magnesium:{density:1.74,color:metalColors.MAGNESIUM,contrastBg:contrastBackgrounds.DARK_BLUE},Beryllium:{density:1.85,color:metalColors.BERYLLIUM,contrastBg:contrastBackgrounds.DARK_BLUE},Titanium:{density:4.51,color:metalColors.TITANIUM,contrastBg:contrastBackgrounds.LIGHT_GRAY},Zirconium:{density:6.52,color:metalColors.ZIRCONIUM,contrastBg:contrastBackgrounds.DARK_BLUE},Zinc:{density:7.14,color:metalColors.ZINC,contrastBg:contrastBackgrounds.DARK_BLUE},Columbium:{density:8.57,color:metalColors.NICKEL_GRAY,contrastBg:contrastBackgrounds.LIGHT_GRAY},Molybdenum:{density:10.22,color:metalColors.MOLYBDENUM,contrastBg:contrastBackgrounds.LIGHT_GRAY},Silver:{density:10.49,color:metalColors.SILVER_CHROME,contrastBg:contrastBackgrounds.DARK_BLUE},Lead:{density:11.34,color:metalColors.LEAD,contrastBg:contrastBackgrounds.WHITE_SMOKE},Tantalum:{density:16.69,color:metalColors.TANTALUM,contrastBg:contrastBackgrounds.DARK_BLUE},Tungsten:{density:19.25,color:metalColors.TUNGSTEN,contrastBg:contrastBackgrounds.DARK_BLUE},Gold:{density:19.32,color:metalColors.GOLD,contrastBg:contrastBackgrounds.DARK_BLUE},Platinum:{density:21.45,color:metalColors.PLATINUM,contrastBg:contrastBackgrounds.DARK_BLUE},Chrome:{density:7.19,color:metalColors.SILVER_CHROME,contrastBg:contrastBackgrounds.DARK_BLUE},Mercury:{density:13.53,color:metalColors.SILVER_CHROME,contrastBg:contrastBackgrounds.DARK_BLUE},Tin:{density:7.31,color:metalColors.SILVER_CHROME,contrastBg:contrastBackgrounds.DARK_BLUE},"PB/Gunmetal":{density:8.78,color:metalColors.GUNMETAL,contrastBg:contrastBackgrounds.WHITE_SMOKE},Potassium:{density:.86,color:metalColors.POTASSIUM,contrastBg:contrastBackgrounds.DARK_BLUE},"Aluminum 1100":{density:2.71,color:metalColors.ALUMINUM,contrastBg:contrastBackgrounds.SLATE_BLUE},"Aluminum 2011":{density:2.83,color:metalColors.ALUMINUM,contrastBg:contrastBackgrounds.SLATE_BLUE},"Aluminum 2014":{density:2.8,color:metalColors.ALUMINUM,contrastBg:contrastBackgrounds.SLATE_BLUE},"Aluminum 2017":{density:2.8,color:metalColors.ALUMINUM,contrastBg:contrastBackgrounds.SLATE_BLUE},"Aluminum 2024":{density:2.78,color:metalColors.ALUMINUM,contrastBg:contrastBackgrounds.SLATE_BLUE},"Aluminum 3003":{density:2.73,color:metalColors.ALUMINUM,contrastBg:contrastBackgrounds.SLATE_BLUE},"Aluminum 5005":{density:2.7,color:metalColors.ALUMINUM,contrastBg:contrastBackgrounds.SLATE_BLUE},"Aluminum 5052":{density:2.68,color:metalColors.ALUMINUM,contrastBg:contrastBackgrounds.SLATE_BLUE},"Aluminum 5056":{density:2.64,color:metalColors.ALUMINUM,contrastBg:contrastBackgrounds.SLATE_BLUE},"Aluminum 5083":{density:2.66,color:metalColors.ALUMINUM,contrastBg:contrastBackgrounds.SLATE_BLUE},"Aluminum 5086":{density:2.66,color:metalColors.ALUMINUM,contrastBg:contrastBackgrounds.SLATE_BLUE},"Aluminum 6061":{density:2.7,color:metalColors.ALUMINUM,contrastBg:contrastBackgrounds.SLATE_BLUE},"Aluminum 6063":{density:2.7,color:metalColors.ALUMINUM,contrastBg:contrastBackgrounds.SLATE_BLUE},"Aluminum 7050":{density:2.83,color:metalColors.ALUMINUM,contrastBg:contrastBackgrounds.SLATE_BLUE},"Aluminum 7075":{density:2.81,color:metalColors.ALUMINUM,contrastBg:contrastBackgrounds.SLATE_BLUE},"Aluminum 7178":{density:2.83,color:metalColors.ALUMINUM,contrastBg:contrastBackgrounds.SLATE_BLUE},"Nickel 200":{density:8.9,color:metalColors.NICKEL_GRAY,contrastBg:contrastBackgrounds.LIGHT_GRAY},"Nickel 400":{density:8.8,color:metalColors.NICKEL_GRAY,contrastBg:contrastBackgrounds.LIGHT_GRAY},"Nickel R-405":{density:8.83,color:metalColors.NICKEL_GRAY,contrastBg:contrastBackgrounds.LIGHT_GRAY},"Nickel K-500":{density:8.44,color:metalColors.NICKEL_GRAY,contrastBg:contrastBackgrounds.LIGHT_GRAY},"Nickel 600":{density:8.47,color:metalColors.NICKEL_GRAY,contrastBg:contrastBackgrounds.LIGHT_GRAY},"Nickel 625":{density:8.44,color:metalColors.NICKEL_GRAY,contrastBg:contrastBackgrounds.LIGHT_GRAY},"Nickel 800H":{density:7.94,color:metalColors.NICKEL_GRAY,contrastBg:contrastBackgrounds.LIGHT_GRAY},"Nickel 800AT":{density:7.94,color:metalColors.NICKEL_GRAY,contrastBg:contrastBackgrounds.LIGHT_GRAY},"Nickel 825":{density:8.14,color:metalColors.NICKEL_GRAY,contrastBg:contrastBackgrounds.LIGHT_GRAY},"Nickel 330":{density:7.94,color:metalColors.NICKEL_GRAY,contrastBg:contrastBackgrounds.LIGHT_GRAY},"Nickel 20":{density:8.08,color:metalColors.NICKEL_GRAY,contrastBg:contrastBackgrounds.LIGHT_GRAY},"Nickel C-276":{density:8.89,color:metalColors.NICKEL_GRAY,contrastBg:contrastBackgrounds.LIGHT_GRAY},"Nickel 2545MD":{density:7.94,color:metalColors.NICKEL_GRAY,contrastBg:contrastBackgrounds.LIGHT_GRAY}},shapesData={Round:{params:["Diameter (D)","Length (L)"],formula:"π × (D/2)² × length × density",svgFile:"round.svg"},Square:{params:["Width (W)","Length (L)"],formula:"width² × length × density",svgFile:"square.svg"},"Rectangle / Plate / Sheet":{params:["Width (W)","Height (H)","Length (L)"],formula:"width × height × length × density",svgFile:"rectangle.svg"},Hexagonal:{params:["Diameter (D)","Length (L)"],formula:"(√3/2) × D² × length × density",svgFile:"hexagonal.svg"},Octagonal:{params:["Diameter (D)","Length (L)"],formula:"8 × tan(π/8) × (D/2)² × length × density",svgFile:"octagonal.svg"},"CR Square":{params:["Width (W)","Corner Radius (R)","Length (L)"],formula:"(width² - 4×radius² + π×radius²) × length × density",svgFile:"cr-square.svg"},"CR Rectangle":{params:["Width (W)","Height (H)","Corner Radius (R)","Length (L)"],formula:"(width×height - 4×radius² + π×radius²) × length × density",svgFile:"cr-rectangle.svg"},Pipe:{params:["Outer Diameter (OD)","Inner Diameter (ID)","Length (L)"],formula:"π × ((OD/2)² - (ID/2)²) × length × density",svgFile:"pipe.svg"},"Square Pipe":{params:["Width (W)","Wall Thickness (T)","Length (L)"],formula:"(width² - (width-2×wall)²) × length × density",svgFile:"square-pipe.svg"},"Rectangle Pipe":{params:["Width (W)","Height (H)","Wall Thickness (T)","Length (L)"],formula:"(width×height - (width-2×wall)×(height-2×wall)) × length × density",svgFile:"rectangle-pipe.svg"},"Hexagonal (Round)":{params:["Outer Diameter (OD)","Inner Diameter (ID)","Length (L)"],formula:"((√3/2) × OD² - π×(ID/2)²) × length × density",svgFile:"hexagonal-round.svg"},"Square (Round)":{params:["Width (W)","Inner Diameter (ID)","Length (L)"],formula:"(width² - π×(ID/2)²) × length × density",svgFile:"square-round.svg"},Sphere:{params:["Diameter (D)"],formula:"(4/3) × π × (D/2)³ × density",svgFile:"sphere.svg"},Triangle:{params:["Width (W)","Height (H)","Length (L)"],formula:"0.5 × width × height × length × density",svgFile:"triangle.svg"},"Trapezoid / Trapezium":{params:["Width 1 (W1)","Width 2 (W2)","Height (H)","Length (L)"],formula:"0.5 × (W1 + W2) × height × length × density",svgFile:"trapezoid.svg"},Oval:{params:["Width (W)","Height (H)","Length (L)"],formula:"π × (width/2) × (height/2) × length × density",svgFile:"oval.svg"},Angle:{params:["Width (W)","Height (H)","Thickness 1 (T1)","Thickness 2 (T2)","Length (L)"],formula:"(width×T1 + height×T2 - T1×T2) × length × density",svgFile:"angle.svg"},Channel:{params:["Width (W)","Height (H)","Thickness 1 (T1)","Thickness 2 (T2)","Length (L)"],formula:"(width×T1 + 2×height×T2 - 2×T1×T2) × length × density",svgFile:"channel.svg"},"T Bar":{params:["Width (W)","Height (H)","Thickness 1 (T1)","Thickness 2 (T2)","Length (L)"],formula:"(width×T1 + (height-T1)×T2) × length × density",svgFile:"t-bar.svg"},"I Beam":{params:["Width (W)","Height (H)","Flange Thickness (T1)","Web Thickness (T2)","Length (L)"],formula:"(2×width×flange_T + (height-2×flange_T)×web_T) × length × density",svgFile:"i-beam.svg"},"C Shape":{params:["Width (W)","Height (H)","Thickness (T)","Gap (G)","Length (L)"],formula:"width×T + 2×(height-gap)×T × length × density",svgFile:"c-shape.svg"},"E Shape":{params:["Width (W)","Height (H)","Thickness 1 (T1)","Thickness 2 (T2)","Length (L)"],formula:"(3×width×T1 + 2×(height-T1)×T2) × length × density",svgFile:"e-shape.svg"}};function init(){loadMaterials(),loadShapes(),initmwcSelects();try{"undefined"!=typeof THREE&&initThreeJS()}catch(e){}window.addEventListener("orientationchange",function(){setTimeout(function(){"function"==typeof onWindowResize&&onWindowResize()},100)}),window.addEventListener("resize",function(){"function"==typeof onWindowResize&&onWindowResize()})}function loadMaterials(){populateMaterialOptions()}let selectedMaterial=null;function populateMaterialOptions(){const e=document.getElementById("materialOptions");e&&(e.innerHTML="",Object.entries(materialsData).forEach(([t,n])=>{const a=document.createElement("li");a.setAttribute("data-value",t),a.setAttribute("tabindex","0"),a.innerHTML=`\n      <div class="option">\n        <div class="icon" style="background: ${n.color};"></div>\n        <p>${t}</p>\n      </div>\n    `,e.appendChild(a)}))}function initmwcSelects(){document.querySelectorAll(".mwc-select-container").forEach(e=>{e.classList.remove("active")}),document.querySelectorAll(".select_ul li").forEach(e=>{e.setAttribute("tabindex","0")}),document.addEventListener("click",handlemwcSelectClick),document.addEventListener("keydown",handlemwcSelectKeydown)}function determineDropdownDirection(e){const t=e.getBoundingClientRect(),n=window.innerHeight-t.bottom;t.top>n&&n<300?e.classList.add("open-upward"):e.classList.remove("open-upward")}function handlemwcSelectClick(e){if(e.target.closest(".mwc-select-button")){e.preventDefault(),e.stopPropagation();const t=e.target.closest(".mwc-select-button").closest(".mwc-select-container"),n=t.querySelector(".mwc-select-arrow"),a=t.classList.contains("active");return document.querySelectorAll(".mwc-select-container").forEach(e=>{if(e!==t){e.classList.remove("active");const t=e.querySelector(".mwc-select-arrow");t&&t.classList.remove("rotated")}}),a||determineDropdownDirection(t),t.classList.toggle("active",!a),void(n&&n.classList.toggle("rotated",!a))}if(e.target.closest(".select_ul li")){e.preventDefault(),e.stopPropagation();const t=e.target.closest(".select_ul li"),n=t.closest(".mwc-select-container"),a=t.closest(".select_ul"),o=n.querySelector(".mwc-select-arrow"),s=t.getAttribute("data-value");if("materialOptions"===a.id){const e=n.querySelector("#materialSelectText");if(e){const n=t.querySelector(".option p").textContent;e.innerHTML=`<span class="select-icon" style="background: ${materialsData[s].color}"></span> ${n}`}selectedMaterial={name:s,data:materialsData[s]},updateVisualization();const a=new CustomEvent("materialChange",{detail:selectedMaterial,bubbles:!0});n.dispatchEvent(a)}return n.classList.remove("active"),void(o&&o.classList.remove("rotated"))}e.target.closest(".mwc-select-container")||document.querySelectorAll(".mwc-select-container").forEach(e=>{e.classList.remove("active");const t=e.querySelector(".mwc-select-arrow");t&&t.classList.remove("rotated")})}function handlemwcSelectKeydown(e){if(e.target.closest(".mwc-select-container")){const t=e.target.closest(".mwc-select-container"),n=t.classList.contains("active");if(("Enter"===e.key||" "===e.key)&&e.target.closest(".mwc-select-button")){e.preventDefault();return void e.target.closest(".mwc-select-button").click()}if(n&&("ArrowDown"===e.key||"ArrowUp"===e.key)){e.preventDefault();const n=t.querySelectorAll(".select_ul li"),a=document.activeElement,o=Array.from(n).indexOf(a);let s;return s="ArrowDown"===e.key?o<n.length-1?o+1:0:o>0?o-1:n.length-1,void(n[s]&&n[s].focus())}if("Enter"===e.key&&e.target.closest(".select_ul li"))return e.preventDefault(),void e.target.closest(".select_ul li").click();if("Escape"===e.key&&n){e.preventDefault(),t.classList.remove("active");const n=t.querySelector(".mwc-select-arrow");n&&n.classList.remove("rotated");const a=t.querySelector(".mwc-select-button");return void(a&&a.focus())}}}function loadShapes(){initShapeDropdown()}function initShapeDropdown(){const e=document.getElementById("shapeSelectButton"),t=document.getElementById("shapeSelectedText"),n=document.getElementById("shapeArrow"),a=document.getElementById("shapeDropdownOverlay"),o=document.getElementById("shapeDropdownPanel"),s=document.getElementById("shapeCloseButton"),r=document.getElementById("shapeOptionsGrid");let l=!1;function c(){e&&o&&(l=!1,e.classList.remove("active"),n&&n.classList.remove("rotated"),a&&a.classList.remove("active"),o.classList.remove("active"),document.body.classList.remove("no-scroll"),document.body.style.overflow="")}e&&e.addEventListener("click",t=>{t.preventDefault(),l?c():e&&o&&(l=!0,e.classList.add("active"),n&&n.classList.add("rotated"),a&&a.classList.add("active"),o.classList.add("active"),document.body.classList.add("no-scroll"),document.body.style.overflow="hidden")}),a&&a.addEventListener("click",c),s&&s.addEventListener("click",c),document.addEventListener("keydown",e=>{"Escape"===e.key&&l&&c()}),o&&o.addEventListener("click",e=>{e.stopPropagation()}),r&&(r.innerHTML="",Object.keys(shapesData).forEach(e=>{const n=shapesData[e],a=document.createElement("div");a.className="shape-option-item",a.setAttribute("data-value",e);const o=document.createElement("div");o.className="shape-option-icon";const s=document.createElement("img");s.src=`images/shapes/${n.svgFile}`,s.alt=e,s.onerror=function(){this.style.display="none",o.innerHTML='<div style="width:50px;height:50px;background:#ddd;"></div>'},o.appendChild(s);const l=document.createElement("div");l.className="shape-option-label",l.textContent=e,a.appendChild(o),a.appendChild(l),a.addEventListener("click",()=>{if(document.querySelectorAll(".shape-option-item").forEach(e=>e.classList.remove("selected")),a.classList.add("selected"),t){const a=document.getElementById("shapeSelectIcon");a&&(a.innerHTML=`<img src="images/shapes/${n.svgFile}" alt="${e}" style="width: 100%; height: 100%; object-fit: contain;">`),t.innerHTML=`<span class="select-svg-icon" id="shapeSelectIcon"><img src="images/shapes/${n.svgFile}" alt="${e}" style="width: 100%; height: 100%; object-fit: contain;"></span> ${e}`}currentSelectedShape=e,updateDimensions(),updateVisualization(),c()}),r.appendChild(a)}))}async function loadShapeIcon(e,t=!0){const n=document.getElementById("shapeIcon");if(e&&shapesData[e]&&shapesData[e].svgFile)try{const a=shapesData[e].svgFile,o=await fetch(`images/dimension/${a}`);if(!o.ok)throw new Error(`Failed to load SVG: ${o.status}`);const s=await o.text();n.innerHTML=s,t&&selectedMaterial&&selectedMaterial.data&&updateSvgColor(selectedMaterial.data.color)}catch(e){n.innerHTML='\n      <svg width="200" height="115" viewBox="0 0 200 115" xmlns="http://www.w3.org/2000/svg">\n        <text x="100" y="57.5" text-anchor="middle" font-family="Arial" font-size="12" fill="#666">\n          Shape diagram unavailable\n        </text>\n      </svg>\n    '}else n.innerHTML='\n      <svg width="200" height="115" viewBox="0 0 200 115" xmlns="http://www.w3.org/2000/svg">\n        <text x="100" y="57.5" text-anchor="middle" font-family="Arial" font-size="14" fill="#666">\n          Select a shape to view\n        </text>\n      </svg>\n    '}function updateSvgColor(e){const t=document.getElementById("shapeIcon").querySelector("svg");if(!t)return;const n=t.querySelectorAll("path, circle, rect, polygon, ellipse, line, g"),a=["white","#ffffff","#FFFFFF","#D9D9D9","#d9d9d9","#F0F0F0","#f0f0f0"];n.forEach(t=>{const n=t.getAttribute("fill"),o=t.getAttribute("style"),s=t.getAttribute("fill-opacity"),r=a.includes(n)||s&&parseFloat(s)<1;if(n&&"none"!==n&&"transparent"!==n&&!r&&t.setAttribute("fill",e),s&&parseFloat(s)<1&&("white"===n||a.includes(n)?t.setAttribute("fill","white"):t.setAttribute("fill",e)),o){let n=o;const s=o.match(/fill:\s*([^;]+)/);if(s){const t=s[1].trim();a.includes(t)||(n=n.replace(/fill:\s*[^;]+/g,`fill:${e}`))}if(o.includes("stroke:")){const t=o.match(/stroke:\s*([^;]+)/);if(t){const o=t[1].trim();a.includes(o)||(n=n.replace(/stroke:\s*[^;]+/g,`stroke:${e}`))}}n!==o&&t.setAttribute("style",n)}const l=t.getAttribute("stroke");l&&"none"!==l&&"transparent"!==l&&!a.includes(l)&&t.setAttribute("stroke",e)})}function resetSvgToDefault(){if(!document.getElementById("shapeIcon").querySelector("svg"))return;const e=currentSelectedShape;e&&shapesData[e]&&shapesData[e].svgFile&&loadShapeIcon(e,!1)}function updateDimensions(){const e=currentSelectedShape,t=document.getElementById("dimensions");if(document.getElementById("results").classList.add("hidden"),loadShapeIcon(e),!e)return void(t.innerHTML="");const n=shapesData[e].params;let a="";n.forEach((e,t)=>{a+=`\n            <div class="dimension-row">\n                <div class="dimension-input">\n                    <div class="form-group">\n                        <label class="form-label" for="param${t+1}">${e}</label>\n                        <div class="input-container">\n                            <input type="number" id="param${t+1}" class="form-input" step="0.001" min="0.001" placeholder="Enter ${e}">\n                        </div>\n                    </div>\n                    <div class="form-group">\n                        <label class="form-label" for="unit${t+1}">Unit</label>\n                        <div class="select-container">\n                            <select id="unit${t+1}" class="form-select">\n                                <option value="in">Inch</option>\n                                <option value="cm">Centimeter</option>\n                                <option value="mm">Millimeter</option>\n                                <option value="ft">Feet</option>\n                                <option value="yd">Yard</option>\n                                <option value="m">Meter</option>\n                            </select>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `}),t.innerHTML=a,n.forEach((e,t)=>{const n=document.getElementById(`param${t+1}`),a=document.getElementById(`unit${t+1}`);n&&n.addEventListener("input",updateVisualization),a&&a.addEventListener("change",updateVisualization)}),updateVisualization()}function updateVisualization(){const e=selectedMaterial?selectedMaterial.name:null,t=currentSelectedShape;if(!t){"function"==typeof clearThreeJSVisualization&&clearThreeJSVisualization();const e=document.querySelector(".icon-section");e&&(e.style.backgroundColor="");const t=document.querySelector(".shape-container");t&&(t.style.backgroundColor="");document.getElementById("materialInfo").innerHTML="";return void(document.getElementById("shapeInfo").textContent="Choose a material and shape to see the 3D visualization")}const n=e?materialsData[e].color:"#0F52BA",a=document.getElementById("shapeInfo"),o=document.getElementById("materialInfo");if(e&&materialsData[e]){updateSvgColor(materialsData[e].color);const t=document.querySelector(".icon-section");t&&materialsData[e].contrastBg?t.style.backgroundColor=materialsData[e].contrastBg:t&&(t.style.backgroundColor="");const n=document.querySelector(".shape-container");n&&materialsData[e].contrastBg?n.style.backgroundColor=materialsData[e].contrastBg:n&&(n.style.backgroundColor="")}else{resetSvgToDefault();const e=document.querySelector(".icon-section");e&&(e.style.backgroundColor="");const t=document.querySelector(".shape-container");t&&(t.style.backgroundColor="")}if(e){const t=materialsData[e];o.innerHTML=`\n            <strong>${e}</strong><br>\n            Density: ${t.density} g/cm³\n        `}else o.innerHTML="";const s={},r=shapesData[t];if(r&&r.params&&r.params.forEach((e,t)=>{const n=document.getElementById(`param${t+1}`),a=document.getElementById(`unit${t+1}`);if(n&&n.value&&a){const t=parseFloat(n.value),o=a.value;if(t>0){const n=convertToInches(t,o),a=e.toLowerCase();a.includes("diameter")?a.includes("outer")?s.outerDiameter=n:a.includes("inner")?s.innerDiameter=n:s.diameter=n:a.includes("width")?a.includes("1")?s.width1=n:a.includes("2")?s.width2=n:a.includes("inner")?s.innerWidth=n:s.width=n:a.includes("height")?a.includes("inner")?s.innerHeight=n:s.height=n:a.includes("length")?s.length=n:a.includes("thickness")?a.includes("1")?s.thickness1=n:a.includes("2")?s.thickness2=n:a.includes("wall")?s.wall=n:s.thickness=n:a.includes("wall")?s.wall=n:a.includes("radius")?s.radius=n:a.includes("gap")&&(s.gap=n)}}}),"function"==typeof create3DShape){const a=e&&materialsData[e].contrastBg?materialsData[e].contrastBg:null;create3DShape(t,n,s,a)}a.textContent=`${t} - ${shapesData[t].formula}`}function convertToCentimeters(e,t){switch(t){case"mm":return e/10;case"cm":default:return e;case"m":return 100*e;case"in":return 2.54*e;case"ft":return 30.48*e;case"yd":return 91.44*e}}function convertToInches(e,t){switch(t){case"cm":return e/2.54;case"m":return 100*e/2.54;case"mm":return e/10/2.54;case"ft":return 12*e;case"yd":return 36*e;default:return e}}function calculateWeight(){const e=selectedMaterial?selectedMaterial.name:null,t=currentSelectedShape,n=document.getElementById("quantity"),a=n&&parseFloat(n.value)||1;if(!e||!t)return void alert("Please select both material and shape");const o=shapesData[t],s=materialsData[e],r=[];for(let e=1;e<=o.params.length;e++){const t=document.getElementById(`param${e}`),n=document.getElementById(`unit${e}`);if(!t||!n)return void alert(`Missing parameter fields for ${o.params[e-1]}`);const a=parseFloat(t.value),s=n.value;if(!a||a<=0)return void alert(`Please enter a valid value for ${o.params[e-1]}`);r.push(convertToCentimeters(a,s))}let l=0;try{switch(t){case"Round":const e=r[0]/2;l=Math.PI*e*e*r[1];break;case"Sphere":const t=r[0]/2;l=4/3*Math.PI*Math.pow(t,3);break;case"Square":l=r[0]*r[0]*r[1];break;case"Rectangle":case"Plate":case"Sheet":case"Rectangle/Plate":case"Rectangle / Plate / Sheet":l=r[0]*r[1]*r[2];break;case"Hexagonal":l=Math.sqrt(3)/2*r[0]*r[0]*r[1];break;case"Octagonal":const n=r[0]/2;l=8*Math.tan(Math.PI/8)*n*n*r[1];break;case"Pipe":const a=r[0]/2,o=r[1]/2;if(o>=a)return void alert("Inner diameter must be less than outer diameter!");l=Math.PI*(a*a-o*o)*r[2];break;case"Square Pipe":const s=r[0]*r[0],c=r[0]-2*r[1];if(c<=0)return void alert("Wall thickness too large for outer dimension!");l=(s-c*c)*r[2];break;case"Rectangle Pipe":const i=r[0]*r[1],d=r[0]-2*r[2],u=r[1]-2*r[2];if(d<=0||u<=0)return void alert("Wall thickness too large for outer dimensions!");l=(i-d*u)*r[3];break;case"Triangle":l=.5*r[0]*r[1]*r[2];break;case"Trapezoid":case"Trapezium":case"Trapezoid / Trapezium":l=.5*(r[0]+r[1])*r[2]*r[3];break;case"Oval":l=Math.PI*(r[0]/2)*(r[1]/2)*r[2];break;case"Hexagonal (Round)":const m=Math.sqrt(3)/2*r[0]*r[0],g=r[1]/2;if(r[1]>=r[0])return void alert("Inner diameter must be less than outer diameter!");l=(m-Math.PI*g*g)*r[2];break;case"Square (Round)":const h=r[0]*r[0],p=r[1]/2;l=(h-Math.PI*p*p)*r[2];break;case"CR Square":l=(r[0]*r[0]-4*r[1]*r[1]+Math.PI*r[1]*r[1])*r[2];break;case"CR Rectangle":l=(r[0]*r[1]-4*r[2]*r[2]+Math.PI*r[2]*r[2])*r[3];break;case"Angle":l=(r[0]*r[2]+r[1]*r[3]-r[2]*r[3])*r[4];break;case"Channel":l=(r[0]*r[2]+2*r[1]*r[3]-2*r[2]*r[3])*r[4];break;case"C Shape":l=(r[0]*r[2]+2*(r[1]-r[3])*r[2])*r[4];break;case"T Bar":l=(r[0]*r[2]+(r[1]-r[2])*r[3])*r[4];break;case"I Beam":const L=2*r[0]*r[2],B=(r[1]-2*r[2])*r[3];l=(L+B)*r[4];break;case"E Shape":l=(3*r[0]*r[2]+2*(r[1]-r[2])*r[3])*r[4];break;default:l=r[0]*r[1]*(r[2]||1)}const e=l*s.density*a,n=e/1e3,o=2.20462*n,c=16*o,i=document.getElementById("weightKgs"),d=document.getElementById("weightGrams"),u=document.getElementById("weightLbs"),m=document.getElementById("weightOunces");i&&(i.textContent=n.toFixed(3)),d&&(d.textContent=e.toFixed(2)),u&&(u.textContent=o.toFixed(3)),m&&(m.textContent=c.toFixed(2));const g=document.getElementById("rate"),h=document.getElementById("rateUnit"),p=document.getElementById("totalCost"),L=g?parseFloat(g.value):0,B=h?h.value:"per kg";if(L&&L>0){let t=0,a="";switch(B){case"per kg":t=L*n,a=L.toFixed(1)+"/kg";break;case"per lb":t=L*o,a=L.toFixed(1)+"/lb";break;case"per gram":t=L*e,a=L.toFixed(3)+"/g";break;case"per ounce":t=L*c,a=L.toFixed(3)+"/oz"}const s=document.getElementById("costValue");s&&(s.textContent=`(${a}) : ${t.toFixed(2)}`),p&&p.classList.remove("hidden")}else p&&p.classList.add("hidden");const y=document.getElementById("results");y&&y.classList.remove("hidden")}catch(e){alert("Error in calculation: "+e.message)}}function clearForm(){selectedMaterial=null;const e=document.getElementById("materialSelectText");e&&(e.innerHTML='<span class="select-icon" style="background: var(--primary-blue)"></span> Select Material...'),currentSelectedShape="";const t=document.getElementById("quantity"),n=document.getElementById("rate"),a=document.getElementById("rateUnit"),o=document.getElementById("dimensions"),s=document.getElementById("results");t&&(t.value="1"),n&&(n.value=""),a&&(a.value="per kg"),o&&(o.innerHTML=""),s&&s.classList.add("hidden");const r=document.getElementById("shapeSelectedText");r&&(r.innerHTML='<span class="select-svg-icon" id="shapeSelectIcon"></span> Select Shape...'),document.querySelectorAll(".shape-option-item").forEach(e=>e.classList.remove("selected")),loadShapeIcon("");const l=document.querySelector(".icon-section");l&&(l.style.backgroundColor="");const c=document.querySelector(".shape-container");c&&(c.style.backgroundColor=""),"function"==typeof clearThreeJSVisualization&&clearThreeJSVisualization();const i=document.getElementById("shapeInfo"),d=document.getElementById("materialInfo");i&&(i.textContent="Choose a material and shape to see the 3D visualization"),d&&(d.innerHTML="")}window.addEventListener("DOMContentLoaded",init),window.calculateWeight=calculateWeight,window.clearForm=clearForm;